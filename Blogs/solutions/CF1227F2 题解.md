pupil 自己想到了 *2400 题目的做法，很开心，加上这是第 $120$ 紫，于是来写题解了。

题意：

> 给定 $n$ 数 $a_i \in [1,k]$，对满足以下要求 $c$ 计数：
> 
> - $\displaystyle\sum\limits_{i=1}^n [a_i=c_i] < \sum\limits_{i=1}^n [a_i=c_{(i \bmod n) + 1}]$
> 
> $n \leq 2 \cdot 10^5,k \leq 10^9$

- 先想 dp，试着一位一位填 $c$，发现给的两个式子的差需要被记录，做不下去。
- 发现数字相对大小不重要，只有是否相等重要。
- 把连续的一段数缩成一个数，令 $b_i(i \in [1,m])$ 表示第 $i$ 段的大小。首尾同样视作相连，因为我们只在意相对顺序。
- 再发现事实上每一段只有最右边的一个数有用，因为其它数字右移一位时对齐的 $a_i$ 相等。
- 问题转化为：$m$ 数，每个数可以选择 $a_i$（仅对左式产生 $1$ 贡献）、$a_{(i \bmod n) + 1}$（仅对右式产生 $1$ 贡献），其它（$k-2$ 填法，两边均不贡献），求方案数，再乘上 $k^{n-m}$。
- 枚举前面两类数字的总数，得到答案计算公式:

$$\displaystyle ans= k^{n-m} \sum\limits_{i=1}^{m} (k-2)^{m-i} \binom{m}{i} \sum_{j=1}^{(i-1)/2} \binom{i}{j}$$

- 考虑化简关于 $j$ 的那个求和。注意到 $j$ 几乎取到了一半值域，而杨辉三角是对称的。熟知 $\displaystyle \sum_{i=0}^n \binom{n}{i} = 2^n$，因此

$$
\begin{aligned}
\binom{n}{i}=\binom{n}{n-i} & \iff \sum_{i=0}^n \binom{2n}{i} = \dfrac{2^{2n}-\binom{2n}{n}}{2} \\
& \iff \sum_{i=0}^n \binom{2n+1}{n} = \dfrac{2^{2n+1}}{2} = 2^{2n+1}
\end{aligned}
$$

- 直接维护即可。复杂度 $O(n)$，如果用快速幂 $O(n \log n)$。
- 代码相当好写，不给了。